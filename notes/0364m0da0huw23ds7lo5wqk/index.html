<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/dendron-wiki/favicon.ico"/><title>Concurrency and Parallelism</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="Concurrency and Parallelism"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://ngocuong0105.github.io/dendron-wiki/notes/0364m0da0huw23ds7lo5wqk/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="7/16/2025"/><meta property="article:modified_time" content="8/6/2025"/><link rel="canonical" href="https://ngocuong0105.github.io/dendron-wiki/notes/0364m0da0huw23ds7lo5wqk/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/dendron-wiki/_next/static/css/73bff7fc08ed1d26.css" as="style"/><link rel="stylesheet" href="/dendron-wiki/_next/static/css/73bff7fc08ed1d26.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/dendron-wiki/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/dendron-wiki/_next/static/chunks/webpack-5a49f804ab2869ab.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/main-2a75a40d33729b12.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/pages/_app-28855ac016325484.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/dendron-wiki/_next/static/hUMuUtBSCkU7YSeQn-rle/_buildManifest.js" defer=""></script><script src="/dendron-wiki/_next/static/hUMuUtBSCkU7YSeQn-rle/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="concurrency-and-parallelism">Concurrency and Parallelism<a aria-hidden="true" class="anchor-heading icon-link" href="#concurrency-and-parallelism"></a></h1>
<h1 id="concurrency-models-in-python">Concurrency Models in Python<a aria-hidden="true" class="anchor-heading icon-link" href="#concurrency-models-in-python"></a></h1>
<p>Chapter 19 from "Fluent Python"</p>
<p>Concurrency is about dealing with multiple things at once.</p>
<p>Parallelism is about doing multiple things at once.</p>
<p>Concurrency is about structure, Parallelism is about execution.</p>
<p>A CPU with 4 cores can run 4 processes in parallel but 100s processes concurrently. </p>
<h1 id="old-notes">Old notes<a aria-hidden="true" class="anchor-heading icon-link" href="#old-notes"></a></h1>
<ul>
<li>concurrent, multithreaded programming, <a href="https://leetcode.com/problems/web-crawler-multithreaded/">web crawler</a></li>
</ul>
<pre class="language-python"><code class="language-Python"><span class="token comment"># simple DFS</span>
<span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">crawl</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> start<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> parser<span class="token punctuation">:</span> <span class="token string">'HtmlParser'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        hostname <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        visited<span class="token punctuation">,</span>stack<span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span>start<span class="token punctuation">]</span>
        <span class="token keyword">while</span> stack<span class="token punctuation">:</span>
            s <span class="token operator">=</span> stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> u <span class="token keyword">in</span> parser<span class="token punctuation">.</span>getUrls<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> u <span class="token keyword">not</span> <span class="token keyword">in</span> visited <span class="token keyword">and</span> hostname<span class="token punctuation">(</span>start<span class="token punctuation">)</span> <span class="token operator">==</span> hostname<span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    visited<span class="token punctuation">.</span>add<span class="token punctuation">(</span>u<span class="token punctuation">)</span>
                    stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span>u<span class="token punctuation">)</span>
        <span class="token keyword">return</span> visited

<span class="token comment"># concurrent DFS</span>
<span class="token keyword">from</span> concurrent <span class="token keyword">import</span> futures
<span class="token keyword">class</span> <span class="token class-name">Solution</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">crawl</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> s<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> parser<span class="token punctuation">:</span> <span class="token string">'HtmlParser'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        hostname <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
        visited <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> futures<span class="token punctuation">.</span>ThreadPoolExecutor<span class="token punctuation">(</span>max_workers<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">as</span> executor<span class="token punctuation">:</span>
            tasks <span class="token operator">=</span> <span class="token punctuation">[</span>executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>parser<span class="token punctuation">.</span>getUrls<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">]</span>
            <span class="token keyword">while</span> tasks<span class="token punctuation">:</span>
                neigh <span class="token operator">=</span> tasks<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>result<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> u <span class="token keyword">in</span> neigh<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> u <span class="token keyword">not</span> <span class="token keyword">in</span> visited <span class="token keyword">and</span> hostname<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">==</span> hostname<span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">:</span>
                        visited<span class="token punctuation">.</span>add<span class="token punctuation">(</span>u<span class="token punctuation">)</span>
                        tasks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>executor<span class="token punctuation">.</span>submit<span class="token punctuation">(</span>parser<span class="token punctuation">.</span>getUrls<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> visited
</code></pre>
<h1 id="deadlocks-and-how-to-properly-acquire-release-locks">Deadlocks and how to properly acquire release locks<a aria-hidden="true" class="anchor-heading icon-link" href="#deadlocks-and-how-to-properly-acquire-release-locks"></a></h1>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Lock
</code></pre>
<p>Common examples of the cause of threading deadlocks include:</p>
<ul>
<li>A thread that waits on itself (acquires itself twice releases once and waits for itself)</li>
<li>Threads that wait on each other (e.g. A waits on B, B waits on A).</li>
<li>Thread that fails to release a resource (e.g. mutex lock, semaphore, barrier, condition, event, etc.).</li>
<li>Threads that acquire mutex locks in different orders (e.g. fail to perform lock ordering).</li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Lock
lock <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># deadlock</span>

<span class="token comment"># no deadlock I think</span>
lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span> 
lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre>
<ul>
<li>
<p><a href="https://leetcode.com/problems/print-in-order/">Print Order</a></p>
</li>
<li>
<p><a href="https://leetcode.com/problems/fizz-buzz-multithreaded/">FizzBuzz</a></p>
</li>
</ul>
<p>malko e mazalo...</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Lock
<span class="token keyword">class</span> <span class="token class-name">FizzBuzz</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>n <span class="token operator">=</span> n
        self<span class="token punctuation">.</span>finish <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>fizz_lock <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>buzz_lock <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fizzbuzz_lock <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>main <span class="token operator">=</span> Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fizz_lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>buzz_lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fizzbuzz_lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># printFizz() outputs "fizz"</span>
    <span class="token keyword">def</span> <span class="token function">fizz</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> printFizz<span class="token punctuation">:</span> <span class="token string">'Callable[[], None]'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>fizz_lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>finish<span class="token punctuation">:</span> <span class="token keyword">return</span>
            printFizz<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>main<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># printBuzz() outputs "buzz"</span>
    <span class="token keyword">def</span> <span class="token function">buzz</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> printBuzz<span class="token punctuation">:</span> <span class="token string">'Callable[[], None]'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>buzz_lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>finish<span class="token punctuation">:</span> <span class="token keyword">return</span>
            printBuzz<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>main<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># printFizzBuzz() outputs "fizzbuzz"</span>
    <span class="token keyword">def</span> <span class="token function">fizzbuzz</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> printFizzBuzz<span class="token punctuation">:</span> <span class="token string">'Callable[[], None]'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>fizzbuzz_lock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>finish<span class="token punctuation">:</span> <span class="token keyword">return</span>
            printFizzBuzz<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>main<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
    <span class="token comment"># printNumber(x) outputs "x", where x is an integer.</span>
    <span class="token keyword">def</span> <span class="token function">number</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> printNumber<span class="token punctuation">:</span> <span class="token string">'Callable[[int], None]'</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>self<span class="token punctuation">.</span>n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>main<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> i <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>fizz_lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token keyword">and</span> i <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>buzz_lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> i <span class="token operator">%</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>fizzbuzz_lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                printNumber<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>main<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>main<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>finish <span class="token operator">=</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>buzz_lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fizz_lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>fizzbuzz_lock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>


</code></pre>
<p>GOAL: Run only one thread at a time!!!!!</p>
<p>Racing conditions are dangerous.</p>
<h1 id="native-coroutines">Native Coroutines<a aria-hidden="true" class="anchor-heading icon-link" href="#native-coroutines"></a></h1>
<p>Python has three ways to run things concurrently</p>
<ul>
<li>coroutines (classic and native)</li>
<li>threads</li>
<li>processes</li>
</ul>
<p>Native coroutines use asyncio library using <code>async def</code> and <code>await</code> syntax</p>
<ul>
<li><code>asyncio</code> is a library that allows the USER to manually create an event loop (with ONE THREAD) and schedule tasks to run concurrently</li>
<li>Allows YOU to multitask with functions!</li>
<li>asyncio is Python’s <strong>standard library</strong></li>
<li><strong>Run time of concurrently ran functions = Run time of slowest function</strong>, if you schedule the tasks to run in the background!</li>
</ul>
<h2 id="creating-background-task">Creating Background Task<a aria-hidden="true" class="anchor-heading icon-link" href="#creating-background-task"></a></h2>
<p>say you have two functions one that takes 10 seconds and one that takes 5 seconds, how can you run them concurrently?</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> asyncio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Starting slow"</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Ended slow"</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">calc_that_does_not_wait_slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">await</span> calc_that_does_not_wait_slow<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">await</span> slow<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> time
<span class="token keyword">print</span><span class="token punctuation">(</span>start<span class="token operator">:=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">:=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span>

<span class="token comment"># takes 15 seconds</span>
<span class="token comment"># even if you swap </span>
<span class="token comment">#       await calc_that_does_not_wait_slow()</span>
<span class="token comment">#       await slow()</span>
<span class="token comment"># it will take 15 seconds</span>
</code></pre>
<p><strong>You need to make them one as background task!</strong> Currently you are running code sequentially.</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> asyncio
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'starting slow'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ended slow'</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">calc_that_does_not_wait_slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    slow_task <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>slow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
    <span class="token keyword">await</span> calc_that_does_not_wait_slow<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># Outside main:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>start<span class="token operator">:=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">:=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span>
<span class="token comment"># Prints 5 seconds only! And 5 seconds after prints ended slow!</span>
<span class="token comment">#  How it runs: </span>
<span class="token comment">#</span>
<span class="token comment">#      slow() is started in the background (will take 10 seconds).</span>
<span class="token comment">#      You immediately start and await calc_that_does_not_wait_slow() (waits 5 seconds, then prints 1).</span>
<span class="token comment">#      When calc_that_does_not_wait_slow() is done (after 5 seconds), main() returns—even if slow() is still running!</span>
<span class="token comment">#      The program ends; slow() may be cancelled or left unfinished.</span>
     
</code></pre>
<p><strong>Lets await the task and the calculation now.</strong></p>
<ul>
<li>await the slow first and then the other -> 15 seconds - sad</li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> asyncio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Starting slow"</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Ended slow"</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">calc_that_does_not_wait_slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      slow_task <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>slow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># background task</span>
      <span class="token keyword">await</span> slow_task
      <span class="token keyword">await</span> calc_that_does_not_wait_slow<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> time
<span class="token keyword">print</span><span class="token punctuation">(</span>start<span class="token operator">:=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">:=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span>

<span class="token comment"># Output</span>
<span class="token comment"># 1754464873.7352946</span>
<span class="token comment"># Starting slow</span>
<span class="token comment"># Ended slow</span>
<span class="token comment"># 1</span>
<span class="token comment"># 1754464888.7525644</span>
<span class="token comment"># 15.017269849777222</span>
</code></pre>
<ul>
<li>await the  slow after and it takes 10 seconds</li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> asyncio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Starting slow"</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Ended slow"</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">calc_that_does_not_wait_slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      slow_task <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>create_task<span class="token punctuation">(</span>slow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">await</span> calc_that_does_not_wait_slow<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">await</span> slow_task
<span class="token keyword">import</span> time
<span class="token keyword">print</span><span class="token punctuation">(</span>start<span class="token operator">:=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">:=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span>

<span class="token comment"># Output </span>
<span class="token comment"># 1754464849.4491456</span>
<span class="token comment"># Starting slow</span>
<span class="token comment"># 1</span>
<span class="token comment"># Ended slow</span>
<span class="token comment"># 1754464859.4551563</span>
<span class="token comment"># 10.00601077079773</span>
</code></pre>
<h2 id="background-tasks-are-confusing---just-use-gather">Background tasks are confusing - just use gather!<a aria-hidden="true" class="anchor-heading icon-link" href="#background-tasks-are-confusing---just-use-gather"></a></h2>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> asyncio

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Starting slow"</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Ended slow"</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">calc_that_does_not_wait_slow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Both coroutines start at once; don't wait for one to finish before the other</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>slow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> calc_that_does_not_wait_slow<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># will run for 10 seconds as well</span>
</code></pre>
<h3 id="summary">Summary<a aria-hidden="true" class="anchor-heading icon-link" href="#summary"></a></h3>
<p><strong>Concurrent async functions:</strong></p>
<ul>
<li>If you want two async functions (coroutines) to run simultaneously, you must schedule them to run at the same time.</li>
<li>await-ing one after the other causes them to run sequentially, so the total run time is the sum of both delays.
</li>
</ul>
<p><strong>Background tasks with create_task:</strong></p>
<ul>
<li>Using asyncio.create_task(coro()) starts a coroutine in the background.</li>
<li>If you don't later await the task, your program may exit before the background task finishes.</li>
<li>If you start the slow task in the background and only await the fast task, the program finishes after the fast task—even if the slow one hadn't finished yet (the slow one is cancelled or left unfinished).</li>
</ul></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#concurrency-models-in-python" title="Concurrency Models in Python">Concurrency Models in Python</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#old-notes" title="Old notes">Old notes</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#deadlocks-and-how-to-properly-acquire-release-locks" title="Deadlocks and how to properly acquire release locks">Deadlocks and how to properly acquire release locks</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#native-coroutines" title="Native Coroutines">Native Coroutines</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#creating-background-task" title="Creating Background Task">Creating Background Task</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#background-tasks-are-confusing---just-use-gather" title="Background tasks are confusing - just use gather!">Background tasks are confusing - just use gather!</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#summary" title="Summary">Summary</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"0364m0da0huw23ds7lo5wqk","title":"Concurrency and Parallelism","desc":"","updated":1754490505063,"created":1752649320880,"custom":{},"fname":"engineering.Concepts.Concurrency and Parallelism","type":"note","vault":{"fsPath":"vault"},"contentHash":"7d3c27b780b6cee5be370dab06a39c91","links":[],"anchors":{"concurrency-models-in-python":{"type":"header","text":"Concurrency Models in Python","value":"concurrency-models-in-python","line":9,"column":0,"depth":1},"old-notes":{"type":"header","text":"Old notes","value":"old-notes","line":23,"column":0,"depth":1},"deadlocks-and-how-to-properly-acquire-release-locks":{"type":"header","text":"Deadlocks and how to properly acquire release locks","value":"deadlocks-and-how-to-properly-acquire-release-locks","line":57,"column":0,"depth":1},"native-coroutines":{"type":"header","text":"Native Coroutines","value":"native-coroutines","line":154,"column":0,"depth":1},"creating-background-task":{"type":"header","text":"Creating Background Task","value":"creating-background-task","line":168,"column":0,"depth":2},"background-tasks-are-confusing---just-use-gather":{"type":"header","text":"Background tasks are confusing - just use gather!","value":"background-tasks-are-confusing---just-use-gather","line":299,"column":0,"depth":2},"summary":{"type":"header","text":"Summary","value":"summary","line":319,"column":0,"depth":3}},"children":[],"parent":"7khpigcji0ufpuptuqozcft","data":{}},"body":"\u003ch1 id=\"concurrency-and-parallelism\"\u003eConcurrency and Parallelism\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#concurrency-and-parallelism\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch1 id=\"concurrency-models-in-python\"\u003eConcurrency Models in Python\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#concurrency-models-in-python\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eChapter 19 from \"Fluent Python\"\u003c/p\u003e\n\u003cp\u003eConcurrency is about dealing with multiple things at once.\u003c/p\u003e\n\u003cp\u003eParallelism is about doing multiple things at once.\u003c/p\u003e\n\u003cp\u003eConcurrency is about structure, Parallelism is about execution.\u003c/p\u003e\n\u003cp\u003eA CPU with 4 cores can run 4 processes in parallel but 100s processes concurrently. \u003c/p\u003e\n\u003ch1 id=\"old-notes\"\u003eOld notes\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#old-notes\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003econcurrent, multithreaded programming, \u003ca href=\"https://leetcode.com/problems/web-crawler-multithreaded/\"\u003eweb crawler\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-Python\"\u003e\u003cspan class=\"token comment\"\u003e# simple DFS\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSolution\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecrawl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e start\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e parser\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'HtmlParser'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e List\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        hostname \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003elambda\u003c/span\u003e x\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e x\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esplit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'/'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n        visited\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003estack\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003estart\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003estart\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e stack\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            s \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e stack\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epop\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e u \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e parser\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egetUrls\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003es\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e u \u003cspan class=\"token keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e visited \u003cspan class=\"token keyword\"\u003eand\u003c/span\u003e hostname\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estart\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e hostname\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eu\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                    visited\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eadd\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eu\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                    stack\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eappend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eu\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e visited\n\n\u003cspan class=\"token comment\"\u003e# concurrent DFS\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e concurrent \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e futures\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSolution\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecrawl\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e s\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e parser\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'HtmlParser'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e List\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token builtin\"\u003estr\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        hostname \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003elambda\u003c/span\u003e x\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e x\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esplit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'/'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n        visited \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eset\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003es\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewith\u003c/span\u003e futures\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eThreadPoolExecutor\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emax_workers\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token number\"\u003e16\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e executor\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            tasks \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eexecutor\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubmit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eparser\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egetUrls\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e s\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e tasks\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                neigh \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tasks\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epop\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eresult\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e u \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e neigh\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e u \u003cspan class=\"token keyword\"\u003enot\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e visited \u003cspan class=\"token keyword\"\u003eand\u003c/span\u003e hostname\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003es\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e hostname\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eu\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                        visited\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eadd\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eu\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                        tasks\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eappend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexecutor\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubmit\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eparser\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egetUrls\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e u\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e visited\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1 id=\"deadlocks-and-how-to-properly-acquire-release-locks\"\u003eDeadlocks and how to properly acquire release locks\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#deadlocks-and-how-to-properly-acquire-release-locks\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e threading \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e Lock\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCommon examples of the cause of threading deadlocks include:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA thread that waits on itself (acquires itself twice releases once and waits for itself)\u003c/li\u003e\n\u003cli\u003eThreads that wait on each other (e.g. A waits on B, B waits on A).\u003c/li\u003e\n\u003cli\u003eThread that fails to release a resource (e.g. mutex lock, semaphore, barrier, condition, event, etc.).\u003c/li\u003e\n\u003cli\u003eThreads that acquire mutex locks in different orders (e.g. fail to perform lock ordering).\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e threading \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e Lock\nlock \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Lock\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nlock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nlock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nlock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e# deadlock\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# no deadlock I think\u003c/span\u003e\nlock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nlock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \nlock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://leetcode.com/problems/print-in-order/\"\u003ePrint Order\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ca href=\"https://leetcode.com/problems/fizz-buzz-multithreaded/\"\u003eFizzBuzz\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003emalko e mazalo...\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e threading \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e Lock\n\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eFizzBuzz\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e__init__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e n\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003eint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003en \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e n\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efinish \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eFalse\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efizz_lock \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Lock\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebuzz_lock \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Lock\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efizzbuzz_lock \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Lock\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emain \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e Lock\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efizz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebuzz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efizzbuzz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e# printFizz() outputs \"fizz\"\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003efizz\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e printFizz\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Callable[[], None]'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efizz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efinish\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e\n            printFizz\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emain\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e# printBuzz() outputs \"buzz\"\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ebuzz\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e printBuzz\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Callable[[], None]'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebuzz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efinish\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e\n            printBuzz\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emain\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e# printFizzBuzz() outputs \"fizzbuzz\"\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003efizzbuzz\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e printFizzBuzz\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Callable[[], None]'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efizzbuzz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efinish\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e\n            printFizzBuzz\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emain\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \n    \u003cspan class=\"token comment\"\u003e# printNumber(x) outputs \"x\", where x is an integer.\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003enumber\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e printNumber\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'Callable[[int], None]'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNone\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003en\u003cspan class=\"token operator\"\u003e+\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emain\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e%\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eand\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e%\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efizz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eelif\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e%\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e \u003cspan class=\"token operator\"\u003e!=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eand\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e%\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebuzz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eelif\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e%\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eand\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e%\u003c/span\u003e \u003cspan class=\"token number\"\u003e5\u003c/span\u003e \u003cspan class=\"token operator\"\u003e==\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efizzbuzz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n                printNumber\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emain\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        \n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emain\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eacquire\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efinish \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebuzz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efizz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efizzbuzz_lock\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erelease\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eGOAL: Run only one thread at a time!!!!!\u003c/p\u003e\n\u003cp\u003eRacing conditions are dangerous.\u003c/p\u003e\n\u003ch1 id=\"native-coroutines\"\u003eNative Coroutines\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#native-coroutines\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003ePython has three ways to run things concurrently\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ecoroutines (classic and native)\u003c/li\u003e\n\u003cli\u003ethreads\u003c/li\u003e\n\u003cli\u003eprocesses\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eNative coroutines use asyncio library using \u003ccode\u003easync def\u003c/code\u003e and \u003ccode\u003eawait\u003c/code\u003e syntax\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003easyncio\u003c/code\u003e is a library that allows the USER to manually create an event loop (with ONE THREAD) and schedule tasks to run concurrently\u003c/li\u003e\n\u003cli\u003eAllows YOU to multitask with functions!\u003c/li\u003e\n\u003cli\u003easyncio is Python’s \u003cstrong\u003estandard library\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eRun time of concurrently ran functions = Run time of slowest function\u003c/strong\u003e, if you schedule the tasks to run in the background!\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"creating-background-task\"\u003eCreating Background Task\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#creating-background-task\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003esay you have two functions one that takes 10 seconds and one that takes 5 seconds, how can you run them concurrently?\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e asyncio\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eslow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Starting slow\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esleep\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Ended slow\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecalc_that_does_not_wait_slow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esleep\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e calc_that_does_not_wait_slow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e slow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e time\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estart\u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e time\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e main\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend\u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e time\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend\u003cspan class=\"token operator\"\u003e-\u003c/span\u003estart\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# takes 15 seconds\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# even if you swap \u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#       await calc_that_does_not_wait_slow()\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#       await slow()\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# it will take 15 seconds\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eYou need to make them one as background task!\u003c/strong\u003e Currently you are running code sequentially.\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e asyncio\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eslow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'starting slow'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esleep\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'ended slow'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecalc_that_does_not_wait_slow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esleep\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    slow_task \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_task\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eslow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e calc_that_does_not_wait_slow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Outside main:\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estart\u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e time\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e main\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend\u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e time\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend\u003cspan class=\"token operator\"\u003e-\u003c/span\u003estart\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Prints 5 seconds only! And 5 seconds after prints ended slow!\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#  How it runs: \u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#      slow() is started in the background (will take 10 seconds).\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#      You immediately start and await calc_that_does_not_wait_slow() (waits 5 seconds, then prints 1).\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#      When calc_that_does_not_wait_slow() is done (after 5 seconds), main() returns—even if slow() is still running!\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e#      The program ends; slow() may be cancelled or left unfinished.\u003c/span\u003e\n     \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eLets await the task and the calculation now.\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eawait the slow first and then the other -\u003e 15 seconds - sad\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e asyncio\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eslow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Starting slow\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esleep\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Ended slow\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecalc_that_does_not_wait_slow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esleep\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      slow_task \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_task\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eslow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e# background task\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e slow_task\n      \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e calc_that_does_not_wait_slow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e time\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estart\u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e time\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e main\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend\u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e time\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend\u003cspan class=\"token operator\"\u003e-\u003c/span\u003estart\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# Output\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# 1754464873.7352946\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Starting slow\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Ended slow\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# 1\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# 1754464888.7525644\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# 15.017269849777222\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eawait the  slow after and it takes 10 seconds\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e asyncio\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eslow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Starting slow\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esleep\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Ended slow\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecalc_that_does_not_wait_slow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esleep\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n      slow_task \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecreate_task\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eslow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e calc_that_does_not_wait_slow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e slow_task\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e time\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estart\u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e time\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e main\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend\u003cspan class=\"token operator\"\u003e:=\u003c/span\u003e time\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend\u003cspan class=\"token operator\"\u003e-\u003c/span\u003estart\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# Output \u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# 1754464849.4491456\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Starting slow\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# 1\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# Ended slow\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# 1754464859.4551563\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# 10.00601077079773\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"background-tasks-are-confusing---just-use-gather\"\u003eBackground tasks are confusing - just use gather!\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#background-tasks-are-confusing---just-use-gather\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e asyncio\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003eslow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Starting slow\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esleep\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e10\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Ended slow\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecalc_that_does_not_wait_slow\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003emain\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e# Both coroutines start at once; don't wait for one to finish before the other\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003eawait\u003c/span\u003e asyncio\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003egather\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eslow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e calc_that_does_not_wait_slow\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# will run for 10 seconds as well\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"summary\"\u003eSummary\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#summary\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eConcurrent async functions:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIf you want two async functions (coroutines) to run simultaneously, you must schedule them to run at the same time.\u003c/li\u003e\n\u003cli\u003eawait-ing one after the other causes them to run sequentially, so the total run time is the sum of both delays.\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eBackground tasks with create_task:\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUsing asyncio.create_task(coro()) starts a coroutine in the background.\u003c/li\u003e\n\u003cli\u003eIf you don't later await the task, your program may exit before the background task finishes.\u003c/li\u003e\n\u003cli\u003eIf you start the slow task in the background and only await the fast task, the program finishes after the fast task—even if the slow one hadn't finished yet (the slow one is cancelled or left unfinished).\u003c/li\u003e\n\u003c/ul\u003e","noteIndex":{"id":"wn8PE1RhG0znK1alrGFYv","title":"Root","desc":"","updated":1744237493819,"created":1631901573363,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"ea936af1aea818f3052610daac103a63","links":[],"anchors":{},"children":["dgcsvcwea8scgdegrk9tfni","xig93vo47ou1bkr7s4w1wb2","ro9bbyftsutm88mxw6r16p5","ypia1zmywsklpicmcgrzlz1","w7iitlako61ppm27mym400a","6bx5plramu4hksomqc1n55z","4nki3bedlvs3mnkixj3a07k","9r5ym61dkwap92fvbte1jkq","849u97nrsuyekmr4a1r92ux","2b5bwf46z6v132wu7xghvrp","dygp5h2vzw4mkromwmofynb","7h50s7ga5ziiyblmoctsqmw","pglaolxcge4xfvgoph3je89","uy9u1co5ih1fokind8tg0eq","jc23ggp8iiu92kpnzo721to","f1u2a47guuw70olv36bzf66","c1bs7wsjfbhb0zipaywqv1","2av385tcj2cbumxprsauff3","v77wdzobzcackzimz6a7crv"],"parent":null,"data":{},"body":"\nWelcome to my Knowledge Base! Here I write about my perception of life, document exciting things I've learned, debate (with myself) on controversial topics. If you know me you will not be surprised to find out that I write mostly about engineering and maths. Other topics I'm interested in are economics, politics, business, chess and poker."},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"dendronVersion":"0.95.0","enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false,"templateHierarchy":"template"},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","assetsPrefix":"/dendron-wiki","siteUrl":"https://ngocuong0105.github.io","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"theme":"light","templateVersion":"0.97.0","ga":{"tracking":"G-W5DRRLQ1N7"},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"0364m0da0huw23ds7lo5wqk"},"buildId":"hUMuUtBSCkU7YSeQn-rle","assetPrefix":"/dendron-wiki","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>