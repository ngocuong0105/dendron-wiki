<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/dendron-wiki/favicon.ico"/><title>CUPED</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="CUPED"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://ngocuong0105.github.io/dendron-wiki/notes/0xdtc9wa6mw28glutw2o8ja/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="10/3/2023"/><meta property="article:modified_time" content="11/14/2023"/><link rel="canonical" href="https://ngocuong0105.github.io/dendron-wiki/notes/0xdtc9wa6mw28glutw2o8ja/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/dendron-wiki/_next/static/css/73bff7fc08ed1d26.css" as="style"/><link rel="stylesheet" href="/dendron-wiki/_next/static/css/73bff7fc08ed1d26.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/dendron-wiki/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/dendron-wiki/_next/static/chunks/webpack-5a49f804ab2869ab.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/main-2a75a40d33729b12.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/pages/_app-47f94d7e2ed9c5e2.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/dendron-wiki/_next/static/AZXonBxzXDJ7mmxS9Br0O/_buildManifest.js" defer=""></script><script src="/dendron-wiki/_next/static/AZXonBxzXDJ7mmxS9Br0O/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="cuped">CUPED<a aria-hidden="true" class="anchor-heading icon-link" href="#cuped"></a></h1>
<h1 id="experiment-setup">Experiment setup<a aria-hidden="true" class="anchor-heading icon-link" href="#experiment-setup"></a></h1>
<p>goal is to estimate the <code>delta = mean(Y_c) - mean(Y_t)</code></p>
<p><img src="/dendron-wiki/assets/images/exp_setup1.png"></p>
<p><img src="/dendron-wiki/assets/images/exp_setup2.png"></p>
<p>We want this estimate to have small varaince and to be unbiased.</p>
<p><em>In this framework, the key to variance reduction for the difference in mean lies in reducing the variance of the means
themselves.</em></p>
<h1 id="what-is-cuped">What is CUPED?<a aria-hidden="true" class="anchor-heading icon-link" href="#what-is-cuped"></a></h1>
<p>CUPED is a well-established variance reduction technique for experiments <a href="https://www.exp-platform.com/Documents/2013-02-CUPED-ImprovingSensitivityOfControlledExperiments.pdf">paper</a></p>
<p>Unlike methods like outlier removal or winsorization, it doesn’t sacrifice any data integrity.</p>
<p>It can be used together with winsorization, which enhances its effectiveness.</p>
<p>It requires pre-experimentation data - which we generally have in Bunsen.</p>
<p>For a rather unpredictable event like ad clicks, we get ~5% reduction in standard deviation (which is ~10% reduction in variance, and experiment run time). For something like sessions, that 5% can increase to something like 30%.</p>
<h1 id="predicted-uncertainty-is-not-uncertainty">Predicted uncertainty is not uncertainty.<a aria-hidden="true" class="anchor-heading icon-link" href="#predicted-uncertainty-is-not-uncertainty"></a></h1>
<p>So the variance in your experiment metric should only take into account the unpredictable part of your measurement. If you predict that:</p>
<ul>
<li>guv A will have 5 sessions during the experiment, and </li>
<li>guv B will have 20 sessions,</li>
</ul>
<p>And when you actually measure the sessions, you get:</p>
<ul>
<li>guv A has 4 sessions (-1 from prediction)</li>
<li>guv B has 21 sessions (+1 from prediction),</li>
</ul>
<p>Then the variance, or the uncertainty, in your measurement can be calculated on the residuals of your predictions, rather than on the measurements themselves. This gives var([-1, +1]), rather than var([4, 21]), which is a great reduction.</p>
<p><a href="https://drive.google.com/file/d/1YYSY9IgZzkp8q9U2ujPc2wuSRVtlgcqq/view?usp=drive_link">notebook</a></p>
<p><a href="https://docs.google.com/presentation/d/1_ae5aQ12v0ykqCLF3JB3urdgHeZuwags/edit#slide=id.p1">presentation</a></p>
<h1 id="control-variates">Control Variates<a aria-hidden="true" class="anchor-heading icon-link" href="#control-variates"></a></h1>
<p>From paper:</p>
<p><img src="/dendron-wiki/assets/images/control_variates.png"></p>
<p><img src="/dendron-wiki/assets/images/control_variates_1.png"></p>
<h1 id="control-variates-in-online-experiments">Control Variates in online experiments<a aria-hidden="true" class="anchor-heading icon-link" href="#control-variates-in-online-experiments"></a></h1>
<p><strong>The difficulty of applying it boils down to finding a control variate <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span></span> that is highly correlated with <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span></span> and at the same time has known <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">E(X)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span></span></span></span></span>.</strong></p>
<p><img src="/dendron-wiki/assets/images/control_variates_2.png"></p>
<p><img src="/dendron-wiki/assets/images/control_variates_3.png"></p>
<p><em>cv</em> stands for control varaites</p>
<h1 id="control-variates-vs-stratification">Control Variates vs Stratification<a aria-hidden="true" class="anchor-heading icon-link" href="#control-variates-vs-stratification"></a></h1>
<p>See <a href="/dendron-wiki/notes/mmuubhdt9s3sxgwzk15ch3n">Stratification</a></p>
<p>These are two techniques that both utilize covariates to achieve variance reduction. The stratification approach uses the covariates to construct strata while the control variates approach uses them as regression variables.</p>
<p>The former uses discrete (or discretized) covariates, whereas control variates seem more naturally to be continuous variables.</p>
<p>Control Variates is an extension of stratification, where the covariate can be an indicator variable showing the belonging of a sample to a stratum.</p>
<p>While these two techniques are well connected mathematically, they provide different insights into understanding why and how to achieve variance reduction. The stratification formulation has a nice analogy with mixture models, where each stratum is one component of the mixture model. Stratification is equivalent to separating samples according to their component memberships, effectively removing the between-component variance and achieving a reduced variance. A better covariate is hence the one that can better classify the samples and align with their underlying structure. On the other hand, the control variates formulation quantifies the amount of variance reduction as a function of the correlation between the covariates and the variable itself. It is mathematically simpler and more elegant. Clearly, a better covariate should be the one with larger (absolute) correlation.</p>
<h1 id="cuped-in-practice">CUPED IN PRACTICE<a aria-hidden="true" class="anchor-heading icon-link" href="#cuped-in-practice"></a></h1>
<p>A simple yet effective way to implement CUPED is to use the same variable from the pre-experiment period as the covariate. You need to have pre-experiment data (have not applied treatment), not good when you work with new users.</p>
<p>The more correlated covariate with the target the larger variance reduction.</p>
<p>Across a large class of metrics, our results consistently showed that using the same variable from the pre-experiment period as the covariate tends to give the best variance reduction. In addition, the lengths of the pre-experiment and the experiment periods also play a role. Given the same pre-experiment period, extending the length of the experiment does not necessarily improve the variance reduction rate. On the other hand, a longer pre-period tends to give a higher reduction for the same experiment period.</p>
<ul>
<li>margarida's implementation</li>
</ul>
<pre class="language-sql"><code class="language-sql"><span class="token comment">-- winsorization 90th %tile + CUPED</span>

  <span class="token keyword">WITH</span> bucketed_assignment_log <span class="token keyword">AS</span> <span class="token punctuation">(</span>
      <span class="token comment">-- macro assign_cohorts start</span>
      <span class="token keyword">SELECT</span> cohort_id<span class="token punctuation">,</span>
             user_id_encid<span class="token punctuation">,</span>
             <span class="token function">MIN</span><span class="token punctuation">(</span>first_assignment_time<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">INTERVAL</span> <span class="token string">'5 SECOND'</span> <span class="token keyword">AS</span> first_assignment_time
        <span class="token keyword">FROM</span> dl_bunsen_filtered<span class="token punctuation">.</span>assignment_log_metric_analysis_v2
       <span class="token keyword">WHERE</span> experiment_run_id <span class="token operator">=</span> <span class="token number">11052</span>
         <span class="token operator">AND</span> <span class="token punctuation">(</span>is_bot <span class="token operator">=</span> <span class="token boolean">FALSE</span> <span class="token operator">OR</span> is_bot <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span>
         <span class="token operator">AND</span> first_assignment_time <span class="token operator">BETWEEN</span> <span class="token string">'2023-07-25'</span> <span class="token comment">-- wildcards are timestamp strings, e.g. '2022-07-28 12:00:00'</span>
           <span class="token operator">AND</span> <span class="token string">'2023-09-25'</span> <span class="token comment">-- note that the single quotes are required</span>
       <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span>
      <span class="token comment">-- macro assign_cohorts end</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>

       connections_data <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> connections<span class="token punctuation">.</span>user_id_encid<span class="token punctuation">,</span>
                                   connections<span class="token punctuation">.</span>object_id<span class="token punctuation">,</span>
                                   datapipe_timestamp <span class="token keyword">AS</span> event_time
                              <span class="token keyword">FROM</span> dl_bunsen_mad<span class="token punctuation">.</span>connections_sessionized_bot_labeled <span class="token keyword">AS</span> connections
                             <span class="token keyword">WHERE</span> <span class="token keyword">TIMESTAMP</span> <span class="token string">'epoch'</span> <span class="token operator">+</span> datapipe_event_time <span class="token operator">/</span> <span class="token number">1000000</span> <span class="token operator">*</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1 second'</span> <span class="token operator">BETWEEN</span> <span class="token string">'2023-07-25'</span>
                                 <span class="token operator">AND</span> <span class="token string">'2023-09-25'</span>
                               <span class="token operator">AND</span> connections<span class="token punctuation">.</span>dt <span class="token operator">BETWEEN</span> <span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token string">'day'</span><span class="token punctuation">,</span> <span class="token string">'2023-07-25'</span>::<span class="token keyword">TIMESTAMP</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1 DAY'</span><span class="token punctuation">)</span>
                                 <span class="token operator">AND</span> <span class="token punctuation">(</span>DATE_TRUNC<span class="token punctuation">(</span><span class="token string">'day'</span><span class="token punctuation">,</span> <span class="token string">'2023-09-25'</span>::<span class="token keyword">TIMESTAMP</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1 DAY'</span><span class="token punctuation">)</span>
                               <span class="token operator">AND</span> connection_type <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'photo_uploaded'</span><span class="token punctuation">)</span>
                               <span class="token operator">AND</span> is_bot <span class="token operator">=</span> <span class="token string">'false'</span>
                             <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

       sum_per_day_per_user <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> cohort_id<span class="token punctuation">,</span>
                                       bucketed_assignment_log<span class="token punctuation">.</span>user_id_encid<span class="token punctuation">,</span>
                                       first_assignment_time<span class="token punctuation">,</span>
                                       <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> object_id<span class="token punctuation">)</span> <span class="token keyword">AS</span> sum_per_day_per_user
                                  <span class="token keyword">FROM</span> bucketed_assignment_log
                                  <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> connections_data
                                      <span class="token keyword">ON</span> bucketed_assignment_log<span class="token punctuation">.</span>user_id_encid <span class="token operator">=</span> connections_data<span class="token punctuation">.</span>user_id_encid
                                          <span class="token operator">AND</span>
                                         connections_data<span class="token punctuation">.</span>event_time <span class="token operator">BETWEEN</span> bucketed_assignment_log<span class="token punctuation">.</span>first_assignment_time
                                             <span class="token operator">AND</span> <span class="token string">'2023-09-25'</span>
                                 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

       percentile_reviews <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> user_id_encid<span class="token punctuation">,</span>
                                     sum_per_day_per_user<span class="token punctuation">,</span>
                                     PERCENTILE_CONT<span class="token punctuation">(</span><span class="token number">0.90</span><span class="token punctuation">)</span> <span class="token keyword">WITHIN</span> <span class="token keyword">GROUP</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sum_per_day_per_user<span class="token punctuation">)</span>
                                     <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> percentile_90
                                <span class="token keyword">FROM</span> sum_per_day_per_user<span class="token punctuation">)</span><span class="token punctuation">,</span>

       censored_photos <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> user_id_encid<span class="token punctuation">,</span>
                                  <span class="token keyword">CASE</span>
                                      <span class="token keyword">WHEN</span> sum_per_day_per_user <span class="token operator">&#x3C;=</span> percentile_90 <span class="token keyword">THEN</span> sum_per_day_per_user
                                      <span class="token keyword">ELSE</span> percentile_90
                                      <span class="token keyword">END</span> <span class="token keyword">AS</span> photos_censored
                             <span class="token keyword">FROM</span> percentile_reviews<span class="token punctuation">)</span><span class="token punctuation">,</span>

       sum_per_user <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> cohort_id<span class="token punctuation">,</span>
                               user_id_encid<span class="token punctuation">,</span>
                               first_assignment_time<span class="token punctuation">,</span>
                               <span class="token keyword">COALESCE</span><span class="token punctuation">(</span>photos_censored<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">/</span>
                               <span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span>SEC<span class="token punctuation">,</span>
                                         TO_DATE<span class="token punctuation">(</span><span class="token string">'2023-07-25'</span><span class="token punctuation">,</span> <span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                         TO_DATE<span class="token punctuation">(</span><span class="token string">'2023-09-25'</span><span class="token punctuation">,</span> <span class="token string">'YYYY-MM-DD'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">86400.</span>
                                   <span class="token punctuation">)</span>::<span class="token keyword">FLOAT</span> <span class="token keyword">AS</span> avg_sum_per_user
                          <span class="token keyword">FROM</span> bucketed_assignment_log
                          <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> censored_photos
                              <span class="token keyword">USING</span> <span class="token punctuation">(</span>user_id_encid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

       get_theta <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> cohort_id<span class="token punctuation">,</span>
                            user_id_encid<span class="token punctuation">,</span>
                            X<span class="token punctuation">,</span>
                            Y<span class="token punctuation">,</span>
                            avg_X<span class="token punctuation">,</span>
                            avg_Y<span class="token punctuation">,</span>
                            var_X<span class="token punctuation">,</span>
                            <span class="token function">SUM</span><span class="token punctuation">(</span><span class="token punctuation">(</span>X <span class="token operator">-</span> avg_X<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>Y <span class="token operator">-</span> avg_Y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>N <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> cov_XY<span class="token punctuation">,</span>
                            cov_XY <span class="token operator">/</span> var_X                                   <span class="token keyword">AS</span> theta
                       <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> cohort_id<span class="token punctuation">,</span>
                                    sum_per_user<span class="token punctuation">.</span>user_id_encid<span class="token punctuation">,</span>
                                    <span class="token keyword">COALESCE</span><span class="token punctuation">(</span>num_photos_in_last_year<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> X<span class="token punctuation">,</span>
                                    avg_sum_per_user                     <span class="token keyword">AS</span> Y<span class="token punctuation">,</span>
                                    <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>                     <span class="token keyword">AS</span> N<span class="token punctuation">,</span>
                                    <span class="token function">AVG</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>                       <span class="token keyword">AS</span> avg_X<span class="token punctuation">,</span>
                                    <span class="token function">AVG</span><span class="token punctuation">(</span>Y<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>                       <span class="token keyword">AS</span> avg_Y<span class="token punctuation">,</span>
                                    VARIANCE<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>                  <span class="token keyword">AS</span> var_X
                               <span class="token keyword">FROM</span> sum_per_user
                               <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> data_science<span class="token punctuation">.</span>contribution_summary
                                   <span class="token keyword">ON</span> sum_per_user<span class="token punctuation">.</span>user_id_encid <span class="token operator">=</span> contribution_summary<span class="token punctuation">.</span>user_id_encid
                                       <span class="token operator">AND</span> contribution_summary<span class="token punctuation">.</span>dt <span class="token operator">=</span>
                                           <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span> <span class="token keyword">FROM</span> data_science<span class="token punctuation">.</span>contribution_summary<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> aux
                      <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> cohort_id<span class="token punctuation">,</span>
                               user_id_encid<span class="token punctuation">,</span>
                               X<span class="token punctuation">,</span>
                               Y<span class="token punctuation">,</span>
                               avg_X<span class="token punctuation">,</span>
                               var_X<span class="token punctuation">,</span>
                               avg_Y<span class="token punctuation">,</span>
                               N<span class="token punctuation">)</span><span class="token punctuation">,</span>

       get_Y_cuped <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> cohort_id<span class="token punctuation">,</span>
                              user_id_encid<span class="token punctuation">,</span>
                              Y <span class="token operator">-</span> theta <span class="token operator">*</span> <span class="token punctuation">(</span>X <span class="token operator">-</span> avg_X<span class="token punctuation">)</span> <span class="token keyword">AS</span> Y_cuped
                         <span class="token keyword">FROM</span> get_theta
                        <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> cohort_id<span class="token punctuation">,</span>
                                 user_id_encid<span class="token punctuation">,</span>
                                 X<span class="token punctuation">,</span>
                                 Y<span class="token punctuation">,</span>
                                 avg_X<span class="token punctuation">,</span>
                                 theta<span class="token punctuation">)</span>

<span class="token keyword">SELECT</span> cohort_id<span class="token punctuation">,</span>
       <span class="token function">COUNT</span><span class="token punctuation">(</span>user_id_encid<span class="token punctuation">)</span> <span class="token keyword">AS</span> sample_size<span class="token punctuation">,</span>
       <span class="token function">AVG</span><span class="token punctuation">(</span>Y_cuped<span class="token punctuation">)</span>         <span class="token keyword">AS</span> metric_value<span class="token punctuation">,</span>
       STDDEV<span class="token punctuation">(</span>Y_cuped<span class="token punctuation">)</span>      <span class="token keyword">AS</span> standard_deviation
  <span class="token keyword">FROM</span> get_Y_cuped
 <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> cohort_id
 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cohort_id<span class="token punctuation">;</span>


</code></pre></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#experiment-setup" title="Experiment setup">Experiment setup</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#what-is-cuped" title="What is CUPED?">What is CUPED?</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#predicted-uncertainty-is-not-uncertainty" title="Predicted uncertainty is not uncertainty.">Predicted uncertainty is not uncertainty.</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#control-variates" title="Control Variates">Control Variates</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#control-variates-in-online-experiments" title="Control Variates in online experiments">Control Variates in online experiments</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#control-variates-vs-stratification" title="Control Variates vs Stratification">Control Variates vs Stratification</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#cuped-in-practice" title="CUPED IN PRACTICE">CUPED IN PRACTICE</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"0xdtc9wa6mw28glutw2o8ja","title":"CUPED","desc":"","updated":1699971536218,"created":1696345019666,"custom":{},"fname":"machine learning.experiments.CUPED","type":"note","vault":{"fsPath":"vault"},"contentHash":"934f83123859c12106e820d62ef5db63","links":[{"type":"wiki","from":{"fname":"machine learning.experiments.CUPED","id":"0xdtc9wa6mw28glutw2o8ja","vaultName":"vault"},"value":"machine learning.experiments.Stratification","position":{"start":{"line":69,"column":5,"offset":2372},"end":{"line":69,"column":52,"offset":2419},"indent":[]},"xvault":false,"sameFile":false,"to":{"fname":"machine learning.experiments.Stratification"}}],"anchors":{"experiment-setup":{"type":"header","text":"Experiment setup","value":"experiment-setup","line":8,"column":0,"depth":1},"what-is-cuped":{"type":"header","text":"What is CUPED?","value":"what-is-cuped","line":22,"column":0,"depth":1},"predicted-uncertainty-is-not-uncertainty":{"type":"header","text":"Predicted uncertainty is not uncertainty.","value":"predicted-uncertainty-is-not-uncertainty","line":35,"column":0,"depth":1},"control-variates":{"type":"header","text":"Control Variates","value":"control-variates","line":52,"column":0,"depth":1},"control-variates-in-online-experiments":{"type":"header","text":"Control Variates in online experiments","value":"control-variates-in-online-experiments","line":62,"column":0,"depth":1},"control-variates-vs-stratification":{"type":"header","text":"Control Variates vs Stratification","value":"control-variates-vs-stratification","line":73,"column":0,"depth":1},"cuped-in-practice":{"type":"header","text":"CUPED IN PRACTICE","value":"cuped-in-practice","line":87,"column":0,"depth":1}},"children":[],"parent":"oyof8xpxyxbquaqceaox78o","data":{}},"body":"\u003ch1 id=\"cuped\"\u003eCUPED\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#cuped\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch1 id=\"experiment-setup\"\u003eExperiment setup\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#experiment-setup\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003egoal is to estimate the \u003ccode\u003edelta = mean(Y_c) - mean(Y_t)\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/dendron-wiki/assets/images/exp_setup1.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/dendron-wiki/assets/images/exp_setup2.png\"\u003e\u003c/p\u003e\n\u003cp\u003eWe want this estimate to have small varaince and to be unbiased.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eIn this framework, the key to variance reduction for the difference in mean lies in reducing the variance of the means\nthemselves.\u003c/em\u003e\u003c/p\u003e\n\u003ch1 id=\"what-is-cuped\"\u003eWhat is CUPED?\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#what-is-cuped\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eCUPED is a well-established variance reduction technique for experiments \u003ca href=\"https://www.exp-platform.com/Documents/2013-02-CUPED-ImprovingSensitivityOfControlledExperiments.pdf\"\u003epaper\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eUnlike methods like outlier removal or winsorization, it doesn’t sacrifice any data integrity.\u003c/p\u003e\n\u003cp\u003eIt can be used together with winsorization, which enhances its effectiveness.\u003c/p\u003e\n\u003cp\u003eIt requires pre-experimentation data - which we generally have in Bunsen.\u003c/p\u003e\n\u003cp\u003eFor a rather unpredictable event like ad clicks, we get ~5% reduction in standard deviation (which is ~10% reduction in variance, and experiment run time). For something like sessions, that 5% can increase to something like 30%.\u003c/p\u003e\n\u003ch1 id=\"predicted-uncertainty-is-not-uncertainty\"\u003ePredicted uncertainty is not uncertainty.\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#predicted-uncertainty-is-not-uncertainty\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eSo the variance in your experiment metric should only take into account the unpredictable part of your measurement. If you predict that:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eguv A will have 5 sessions during the experiment, and \u003c/li\u003e\n\u003cli\u003eguv B will have 20 sessions,\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAnd when you actually measure the sessions, you get:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eguv A has 4 sessions (-1 from prediction)\u003c/li\u003e\n\u003cli\u003eguv B has 21 sessions (+1 from prediction),\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThen the variance, or the uncertainty, in your measurement can be calculated on the residuals of your predictions, rather than on the measurements themselves. This gives var([-1, +1]), rather than var([4, 21]), which is a great reduction.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://drive.google.com/file/d/1YYSY9IgZzkp8q9U2ujPc2wuSRVtlgcqq/view?usp=drive_link\"\u003enotebook\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://docs.google.com/presentation/d/1_ae5aQ12v0ykqCLF3JB3urdgHeZuwags/edit#slide=id.p1\"\u003epresentation\u003c/a\u003e\u003c/p\u003e\n\u003ch1 id=\"control-variates\"\u003eControl Variates\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#control-variates\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eFrom paper:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/dendron-wiki/assets/images/control_variates.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/dendron-wiki/assets/images/control_variates_1.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"control-variates-in-online-experiments\"\u003eControl Variates in online experiments\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#control-variates-in-online-experiments\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e\u003cstrong\u003eThe difficulty of applying it boils down to finding a control variate \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eX\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eX\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eX\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e that is highly correlated with \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eY\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eY\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.22222em;\"\u003eY\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e and at the same time has known \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eE\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003eX\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eE(X)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.05764em;\"\u003eE\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eX\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e.\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/dendron-wiki/assets/images/control_variates_2.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/dendron-wiki/assets/images/control_variates_3.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cem\u003ecv\u003c/em\u003e stands for control varaites\u003c/p\u003e\n\u003ch1 id=\"control-variates-vs-stratification\"\u003eControl Variates vs Stratification\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#control-variates-vs-stratification\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eSee \u003ca href=\"/dendron-wiki/notes/mmuubhdt9s3sxgwzk15ch3n\"\u003eStratification\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eThese are two techniques that both utilize covariates to achieve variance reduction. The stratification approach uses the covariates to construct strata while the control variates approach uses them as regression variables.\u003c/p\u003e\n\u003cp\u003eThe former uses discrete (or discretized) covariates, whereas control variates seem more naturally to be continuous variables.\u003c/p\u003e\n\u003cp\u003eControl Variates is an extension of stratification, where the covariate can be an indicator variable showing the belonging of a sample to a stratum.\u003c/p\u003e\n\u003cp\u003eWhile these two techniques are well connected mathematically, they provide different insights into understanding why and how to achieve variance reduction. The stratification formulation has a nice analogy with mixture models, where each stratum is one component of the mixture model. Stratification is equivalent to separating samples according to their component memberships, effectively removing the between-component variance and achieving a reduced variance. A better covariate is hence the one that can better classify the samples and align with their underlying structure. On the other hand, the control variates formulation quantifies the amount of variance reduction as a function of the correlation between the covariates and the variable itself. It is mathematically simpler and more elegant. Clearly, a better covariate should be the one with larger (absolute) correlation.\u003c/p\u003e\n\u003ch1 id=\"cuped-in-practice\"\u003eCUPED IN PRACTICE\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#cuped-in-practice\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eA simple yet effective way to implement CUPED is to use the same variable from the pre-experiment period as the covariate. You need to have pre-experiment data (have not applied treatment), not good when you work with new users.\u003c/p\u003e\n\u003cp\u003eThe more correlated covariate with the target the larger variance reduction.\u003c/p\u003e\n\u003cp\u003eAcross a large class of metrics, our results consistently showed that using the same variable from the pre-experiment period as the covariate tends to give the best variance reduction. In addition, the lengths of the pre-experiment and the experiment periods also play a role. Given the same pre-experiment period, extending the length of the experiment does not necessarily improve the variance reduction rate. On the other hand, a longer pre-period tends to give a higher reduction for the same experiment period.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003emargarida's implementation\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"language-sql\"\u003e\u003ccode class=\"language-sql\"\u003e\u003cspan class=\"token comment\"\u003e-- winsorization 90th %tile + CUPED\u003c/span\u003e\n\n  \u003cspan class=\"token keyword\"\u003eWITH\u003c/span\u003e bucketed_assignment_log \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e-- macro assign_cohorts start\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e cohort_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n             user_id_encid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n             \u003cspan class=\"token function\"\u003eMIN\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003efirst_assignment_time\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eINTERVAL\u003c/span\u003e \u003cspan class=\"token string\"\u003e'5 SECOND'\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e first_assignment_time\n        \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e dl_bunsen_filtered\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eassignment_log_metric_analysis_v2\n       \u003cspan class=\"token keyword\"\u003eWHERE\u003c/span\u003e experiment_run_id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e11052\u003c/span\u003e\n         \u003cspan class=\"token operator\"\u003eAND\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eis_bot \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eFALSE\u003c/span\u003e \u003cspan class=\"token operator\"\u003eOR\u003c/span\u003e is_bot \u003cspan class=\"token operator\"\u003eIS\u003c/span\u003e \u003cspan class=\"token boolean\"\u003eNULL\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n         \u003cspan class=\"token operator\"\u003eAND\u003c/span\u003e first_assignment_time \u003cspan class=\"token operator\"\u003eBETWEEN\u003c/span\u003e \u003cspan class=\"token string\"\u003e'2023-07-25'\u003c/span\u003e \u003cspan class=\"token comment\"\u003e-- wildcards are timestamp strings, e.g. '2022-07-28 12:00:00'\u003c/span\u003e\n           \u003cspan class=\"token operator\"\u003eAND\u003c/span\u003e \u003cspan class=\"token string\"\u003e'2023-09-25'\u003c/span\u003e \u003cspan class=\"token comment\"\u003e-- note that the single quotes are required\u003c/span\u003e\n       \u003cspan class=\"token keyword\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eBY\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e-- macro assign_cohorts end\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\n       connections_data \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e connections\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003euser_id_encid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                   connections\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eobject_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                   datapipe_timestamp \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e event_time\n                              \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e dl_bunsen_mad\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econnections_sessionized_bot_labeled \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e connections\n                             \u003cspan class=\"token keyword\"\u003eWHERE\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eTIMESTAMP\u003c/span\u003e \u003cspan class=\"token string\"\u003e'epoch'\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e datapipe_event_time \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e1000000\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eINTERVAL\u003c/span\u003e \u003cspan class=\"token string\"\u003e'1 second'\u003c/span\u003e \u003cspan class=\"token operator\"\u003eBETWEEN\u003c/span\u003e \u003cspan class=\"token string\"\u003e'2023-07-25'\u003c/span\u003e\n                                 \u003cspan class=\"token operator\"\u003eAND\u003c/span\u003e \u003cspan class=\"token string\"\u003e'2023-09-25'\u003c/span\u003e\n                               \u003cspan class=\"token operator\"\u003eAND\u003c/span\u003e connections\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edt \u003cspan class=\"token operator\"\u003eBETWEEN\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eDATE_TRUNC\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'day'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'2023-07-25'\u003c/span\u003e::\u003cspan class=\"token keyword\"\u003eTIMESTAMP\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eINTERVAL\u003c/span\u003e \u003cspan class=\"token string\"\u003e'1 DAY'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                 \u003cspan class=\"token operator\"\u003eAND\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eDATE_TRUNC\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'day'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'2023-09-25'\u003c/span\u003e::\u003cspan class=\"token keyword\"\u003eTIMESTAMP\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eINTERVAL\u003c/span\u003e \u003cspan class=\"token string\"\u003e'1 DAY'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                               \u003cspan class=\"token operator\"\u003eAND\u003c/span\u003e connection_type \u003cspan class=\"token operator\"\u003eIN\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'photo_uploaded'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                               \u003cspan class=\"token operator\"\u003eAND\u003c/span\u003e is_bot \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e'false'\u003c/span\u003e\n                             \u003cspan class=\"token keyword\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eBY\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\n       sum_per_day_per_user \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e cohort_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                       bucketed_assignment_log\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003euser_id_encid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                       first_assignment_time\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                       \u003cspan class=\"token function\"\u003eCOUNT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eDISTINCT\u003c/span\u003e object_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e sum_per_day_per_user\n                                  \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e bucketed_assignment_log\n                                  \u003cspan class=\"token keyword\"\u003eINNER\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eJOIN\u003c/span\u003e connections_data\n                                      \u003cspan class=\"token keyword\"\u003eON\u003c/span\u003e bucketed_assignment_log\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003euser_id_encid \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e connections_data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003euser_id_encid\n                                          \u003cspan class=\"token operator\"\u003eAND\u003c/span\u003e\n                                         connections_data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eevent_time \u003cspan class=\"token operator\"\u003eBETWEEN\u003c/span\u003e bucketed_assignment_log\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efirst_assignment_time\n                                             \u003cspan class=\"token operator\"\u003eAND\u003c/span\u003e \u003cspan class=\"token string\"\u003e'2023-09-25'\u003c/span\u003e\n                                 \u003cspan class=\"token keyword\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eBY\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\n       percentile_reviews \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e user_id_encid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                     sum_per_day_per_user\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                     PERCENTILE_CONT\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.90\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eWITHIN\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eORDER\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eBY\u003c/span\u003e sum_per_day_per_user\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n                                     \u003cspan class=\"token keyword\"\u003eOVER\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e percentile_90\n                                \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e sum_per_day_per_user\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\n       censored_photos \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e user_id_encid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                  \u003cspan class=\"token keyword\"\u003eCASE\u003c/span\u003e\n                                      \u003cspan class=\"token keyword\"\u003eWHEN\u003c/span\u003e sum_per_day_per_user \u003cspan class=\"token operator\"\u003e\u0026#x3C;=\u003c/span\u003e percentile_90 \u003cspan class=\"token keyword\"\u003eTHEN\u003c/span\u003e sum_per_day_per_user\n                                      \u003cspan class=\"token keyword\"\u003eELSE\u003c/span\u003e percentile_90\n                                      \u003cspan class=\"token keyword\"\u003eEND\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e photos_censored\n                             \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e percentile_reviews\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\n       sum_per_user \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e cohort_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               user_id_encid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               first_assignment_time\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               \u003cspan class=\"token keyword\"\u003eCOALESCE\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ephotos_censored\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\n                               \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eDATEDIFF\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eSEC\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                         TO_DATE\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'2023-07-25'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'YYYY-MM-DD'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                         TO_DATE\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'2023-09-25'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e'YYYY-MM-DD'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token number\"\u003e86400.\u003c/span\u003e\n                                   \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e::\u003cspan class=\"token keyword\"\u003eFLOAT\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e avg_sum_per_user\n                          \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e bucketed_assignment_log\n                          \u003cspan class=\"token keyword\"\u003eLEFT\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eJOIN\u003c/span\u003e censored_photos\n                              \u003cspan class=\"token keyword\"\u003eUSING\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser_id_encid\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\n       get_theta \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e cohort_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            user_id_encid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            X\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            Y\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            avg_X\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            avg_Y\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            var_X\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            \u003cspan class=\"token function\"\u003eSUM\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e avg_X\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eY \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e avg_Y\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eN \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eOVER\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e cov_XY\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                            cov_XY \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e var_X                                   \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e theta\n                       \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e cohort_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                    sum_per_user\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003euser_id_encid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                    \u003cspan class=\"token keyword\"\u003eCOALESCE\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enum_photos_in_last_year\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e X\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                    avg_sum_per_user                     \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e Y\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                    \u003cspan class=\"token function\"\u003eCOUNT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eOVER\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e                     \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e N\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                    \u003cspan class=\"token function\"\u003eAVG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eOVER\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e                       \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e avg_X\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                    \u003cspan class=\"token function\"\u003eAVG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eY\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eOVER\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e                       \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e avg_Y\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                    VARIANCE\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eOVER\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e                  \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e var_X\n                               \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e sum_per_user\n                               \u003cspan class=\"token keyword\"\u003eLEFT\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eJOIN\u003c/span\u003e data_science\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econtribution_summary\n                                   \u003cspan class=\"token keyword\"\u003eON\u003c/span\u003e sum_per_user\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003euser_id_encid \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e contribution_summary\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003euser_id_encid\n                                       \u003cspan class=\"token operator\"\u003eAND\u003c/span\u003e contribution_summary\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edt \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\n                                           \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e \u003cspan class=\"token function\"\u003eMAX\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edt\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e data_science\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econtribution_summary\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e aux\n                      \u003cspan class=\"token keyword\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eBY\u003c/span\u003e cohort_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               user_id_encid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               X\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               Y\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               avg_X\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               var_X\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               avg_Y\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                               N\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\n       get_Y_cuped \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e cohort_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                              user_id_encid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                              Y \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e theta \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eX \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e avg_X\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e Y_cuped\n                         \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e get_theta\n                        \u003cspan class=\"token keyword\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eBY\u003c/span\u003e cohort_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                 user_id_encid\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                 X\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                 Y\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                 avg_X\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n                                 theta\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eSELECT\u003c/span\u003e cohort_id\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003eCOUNT\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003euser_id_encid\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e sample_size\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n       \u003cspan class=\"token function\"\u003eAVG\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eY_cuped\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e         \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e metric_value\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n       STDDEV\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eY_cuped\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e      \u003cspan class=\"token keyword\"\u003eAS\u003c/span\u003e standard_deviation\n  \u003cspan class=\"token keyword\"\u003eFROM\u003c/span\u003e get_Y_cuped\n \u003cspan class=\"token keyword\"\u003eGROUP\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eBY\u003c/span\u003e cohort_id\n \u003cspan class=\"token keyword\"\u003eORDER\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eBY\u003c/span\u003e cohort_id\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\n\u003c/code\u003e\u003c/pre\u003e","noteIndex":{"id":"wn8PE1RhG0znK1alrGFYv","title":"Root","desc":"","updated":1763992060664,"created":1631901573363,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"dc095b340c158394d643b84f8585ff0c","links":[],"anchors":{},"children":["dgcsvcwea8scgdegrk9tfni","xig93vo47ou1bkr7s4w1wb2","ro9bbyftsutm88mxw6r16p5","ypia1zmywsklpicmcgrzlz1","w7iitlako61ppm27mym400a","6bx5plramu4hksomqc1n55z","4nki3bedlvs3mnkixj3a07k","9r5ym61dkwap92fvbte1jkq","849u97nrsuyekmr4a1r92ux","2b5bwf46z6v132wu7xghvrp","dygp5h2vzw4mkromwmofynb","7h50s7ga5ziiyblmoctsqmw","pglaolxcge4xfvgoph3je89","uy9u1co5ih1fokind8tg0eq","jc23ggp8iiu92kpnzo721to","f1u2a47guuw70olv36bzf66","c1bs7wsjfbhb0zipaywqv1","2av385tcj2cbumxprsauff3","lw1b4r6ykimvj9208nkgzps"],"parent":null,"data":{},"body":"\nZdr bebce kp ;)\n\nThis is my knowledge base, additionally I keep [daily journal](https://docs.google.com/document/d/1m8Npu0-t8RweyKiHCjLL1PPDYzbebqm3OZDHH8IVsb8/edit?tab=t.rj0kvkrm7zpr)."},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"dendronVersion":"0.95.0","enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false,"templateHierarchy":"template"},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","assetsPrefix":"/dendron-wiki","siteUrl":"https://ngocuong0105.github.io","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"theme":"light","templateVersion":"0.97.0","ga":{"tracking":"G-W5DRRLQ1N7"},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"0xdtc9wa6mw28glutw2o8ja"},"buildId":"AZXonBxzXDJ7mmxS9Br0O","assetPrefix":"/dendron-wiki","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>