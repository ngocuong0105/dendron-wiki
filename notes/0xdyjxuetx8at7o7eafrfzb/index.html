<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/dendron-wiki/favicon.ico"/><title>How does Yelp store data?</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="How does Yelp store data?"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://ngocuong0105.github.io/dendron-wiki/notes/0xdyjxuetx8at7o7eafrfzb/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2/14/2023"/><meta property="article:modified_time" content="2/14/2023"/><link rel="canonical" href="https://ngocuong0105.github.io/dendron-wiki/notes/0xdyjxuetx8at7o7eafrfzb/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/dendron-wiki/_next/static/css/73bff7fc08ed1d26.css" as="style"/><link rel="stylesheet" href="/dendron-wiki/_next/static/css/73bff7fc08ed1d26.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/dendron-wiki/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/dendron-wiki/_next/static/chunks/webpack-5a49f804ab2869ab.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/main-2a75a40d33729b12.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/pages/_app-47f94d7e2ed9c5e2.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/dendron-wiki/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/dendron-wiki/_next/static/AZXonBxzXDJ7mmxS9Br0O/_buildManifest.js" defer=""></script><script src="/dendron-wiki/_next/static/AZXonBxzXDJ7mmxS9Br0O/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="how-does-yelp-store-data">How does Yelp store data?<a aria-hidden="true" class="anchor-heading icon-link" href="#how-does-yelp-store-data"></a></h1>
<h1 id="how-does-amazon-help-us-store-data">How does Amazon help us store data<a aria-hidden="true" class="anchor-heading icon-link" href="#how-does-amazon-help-us-store-data"></a></h1>
<p>We use two data storage tools:</p>
<ul>
<li>Amazon RedShift</li>
<li>Amazon S3 (Data Lake)</li>
</ul>
<p>Every second users from all over the world are using Yelp App or Website and generating data. Engineers wrote code to store event logs into S3 (Amazon Simple Storage Service). The data in S3 form a <strong>data lake</strong>.</p>
<p>S3 has a lot of pros:</p>
<p>Very cheap for storage</p>
<ul>
<li>Upon writing, there’s no schema required. Any format is accepted</li>
<li>Upon reading, there’s no barrier between files / tables</li>
</ul>
<p>But it also have some cons:</p>
<ul>
<li>Data quality is not guaranteed. It might require users to clean and write the schema for the data when reading the data. </li>
<li>It’s not the fastest </li>
</ul>
<p>Therefore, for the data that we have high usage, on a daily basis we clean the logs and write them into <strong>Redshift</strong>, where it is expensive to store but very fast and cheap to query. Redshift ensures the data schema is carefully designed before data is written. </p>
<p>Problem is Redshift clusters are isolated with each other, you can’t join two tables in different Redshift clusters and drive insights. </p>
<p>Solutions:</p>
<ol>
<li>Let users load tables into a third place then join them. For example, we can use a jupyter notebook to run queries separately on different clusters, then join them together with pandas. - Very very slow</li>
<li>Add tables to the same cluster. - We do it sometimes, that’s why you see the same table in different clusters, but we can’t store all Yelp tables in one cluster, so this can’t completely solve the problem. Plus, this is very very expensive.
For example, in “ad-metrics” cluster, we have a table “ad-slot-metrics”, the same table is copied to “Bunsen” cluster, under “bunsen” folder, “ad_event” table</li>
<li>Copy data from Amazon Redshift to Amazon S3. (For example, you can find “ad metrics” in both Redshift and S3: )Then there are a few options:</li>
</ol>
<ul>
<li>People can query the data lake with Amazon Athena. (Athena directly accesses data from S3 using SQL query.)</li>
<li>People can query data lake directly with Spark</li>
<li>Set up <strong>Amazon Redshift Spectrum</strong>, which is a connector that connects a Redshift cluster with certain databases / tables in S3. Then people only need to connect with one Redshift cluster and can query tables outside of the cluster just like the tables inside the cluster! (As long as the connection for the specific tables has been set up)</li>
</ul>
<hr>
<strong>Backlinks</strong>
<ul>
<li><a href="/dendron-wiki/notes/03gbxiq9kwvv3tq2zpwbjjo">S3 vs DL vs Redshift</a></li>
</ul></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#how-does-amazon-help-us-store-data" title="How does Amazon help us store data">How does Amazon help us store data</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"0xdyjxuetx8at7o7eafrfzb","title":"How does Yelp store data?","desc":"","updated":1676376255488,"created":1676375568620,"custom":{},"fname":"engineering.AWS.How does Yelp store data?","type":"note","vault":{"fsPath":"vault"},"contentHash":"b425a45f343893731ed879c15882343a","links":[{"from":{"fname":"engineering.AWS.S3 vs DL vs Redshift","id":"03gbxiq9kwvv3tq2zpwbjjo","vaultName":"vault"},"type":"backlink","position":{"start":{"line":33,"column":5,"offset":1716},"end":{"line":33,"column":50,"offset":1761},"indent":[]},"value":"engineering.AWS.How does Yelp store data?"}],"anchors":{"how-does-amazon-help-us-store-data":{"type":"header","text":"How does Amazon help us store data","value":"how-does-amazon-help-us-store-data","line":8,"column":0,"depth":1}},"children":[],"parent":"poc9vlh4u5k814ql4zlyuxw","data":{}},"body":"\u003ch1 id=\"how-does-yelp-store-data\"\u003eHow does Yelp store data?\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#how-does-yelp-store-data\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch1 id=\"how-does-amazon-help-us-store-data\"\u003eHow does Amazon help us store data\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#how-does-amazon-help-us-store-data\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003eWe use two data storage tools:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAmazon RedShift\u003c/li\u003e\n\u003cli\u003eAmazon S3 (Data Lake)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eEvery second users from all over the world are using Yelp App or Website and generating data. Engineers wrote code to store event logs into S3 (Amazon Simple Storage Service). The data in S3 form a \u003cstrong\u003edata lake\u003c/strong\u003e.\u003c/p\u003e\n\u003cp\u003eS3 has a lot of pros:\u003c/p\u003e\n\u003cp\u003eVery cheap for storage\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUpon writing, there’s no schema required. Any format is accepted\u003c/li\u003e\n\u003cli\u003eUpon reading, there’s no barrier between files / tables\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eBut it also have some cons:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eData quality is not guaranteed. It might require users to clean and write the schema for the data when reading the data. \u003c/li\u003e\n\u003cli\u003eIt’s not the fastest \u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eTherefore, for the data that we have high usage, on a daily basis we clean the logs and write them into \u003cstrong\u003eRedshift\u003c/strong\u003e, where it is expensive to store but very fast and cheap to query. Redshift ensures the data schema is carefully designed before data is written. \u003c/p\u003e\n\u003cp\u003eProblem is Redshift clusters are isolated with each other, you can’t join two tables in different Redshift clusters and drive insights. \u003c/p\u003e\n\u003cp\u003eSolutions:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eLet users load tables into a third place then join them. For example, we can use a jupyter notebook to run queries separately on different clusters, then join them together with pandas. - Very very slow\u003c/li\u003e\n\u003cli\u003eAdd tables to the same cluster. - We do it sometimes, that’s why you see the same table in different clusters, but we can’t store all Yelp tables in one cluster, so this can’t completely solve the problem. Plus, this is very very expensive.\nFor example, in “ad-metrics” cluster, we have a table “ad-slot-metrics”, the same table is copied to “Bunsen” cluster, under “bunsen” folder, “ad_event” table\u003c/li\u003e\n\u003cli\u003eCopy data from Amazon Redshift to Amazon S3. (For example, you can find “ad metrics” in both Redshift and S3: )Then there are a few options:\u003c/li\u003e\n\u003c/ol\u003e\n\u003cul\u003e\n\u003cli\u003ePeople can query the data lake with Amazon Athena. (Athena directly accesses data from S3 using SQL query.)\u003c/li\u003e\n\u003cli\u003ePeople can query data lake directly with Spark\u003c/li\u003e\n\u003cli\u003eSet up \u003cstrong\u003eAmazon Redshift Spectrum\u003c/strong\u003e, which is a connector that connects a Redshift cluster with certain databases / tables in S3. Then people only need to connect with one Redshift cluster and can query tables outside of the cluster just like the tables inside the cluster! (As long as the connection for the specific tables has been set up)\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cstrong\u003eBacklinks\u003c/strong\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/dendron-wiki/notes/03gbxiq9kwvv3tq2zpwbjjo\"\u003eS3 vs DL vs Redshift\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","noteIndex":{"id":"wn8PE1RhG0znK1alrGFYv","title":"Root","desc":"","updated":1763992060664,"created":1631901573363,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":"vault"},"contentHash":"dc095b340c158394d643b84f8585ff0c","links":[],"anchors":{},"children":["dgcsvcwea8scgdegrk9tfni","xig93vo47ou1bkr7s4w1wb2","ro9bbyftsutm88mxw6r16p5","ypia1zmywsklpicmcgrzlz1","w7iitlako61ppm27mym400a","6bx5plramu4hksomqc1n55z","4nki3bedlvs3mnkixj3a07k","9r5ym61dkwap92fvbte1jkq","849u97nrsuyekmr4a1r92ux","2b5bwf46z6v132wu7xghvrp","dygp5h2vzw4mkromwmofynb","7h50s7ga5ziiyblmoctsqmw","pglaolxcge4xfvgoph3je89","uy9u1co5ih1fokind8tg0eq","jc23ggp8iiu92kpnzo721to","f1u2a47guuw70olv36bzf66","c1bs7wsjfbhb0zipaywqv1","2av385tcj2cbumxprsauff3","lw1b4r6ykimvj9208nkgzps"],"parent":null,"data":{},"body":"\nZdr bebce kp ;)\n\nThis is my knowledge base, additionally I keep [daily journal](https://docs.google.com/document/d/1m8Npu0-t8RweyKiHCjLL1PPDYzbebqm3OZDHH8IVsb8/edit?tab=t.rj0kvkrm7zpr)."},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableUserTags":true,"enableHashTags":true,"dendronVersion":"0.95.0","enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false,"templateHierarchy":"template"},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","assetsPrefix":"/dendron-wiki","siteUrl":"https://ngocuong0105.github.io","duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"theme":"light","templateVersion":"0.97.0","ga":{"tracking":"G-W5DRRLQ1N7"},"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"0xdyjxuetx8at7o7eafrfzb"},"buildId":"AZXonBxzXDJ7mmxS9Br0O","assetPrefix":"/dendron-wiki","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>